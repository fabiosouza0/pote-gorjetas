<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pote de Gorjetas</title>
<style>
  /* Seu CSS original permanece igual */
  :root{--bg:#0f1724;--card:#0b1220;--accent:#ffd166;--muted:#9aa6b2;}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui;background:linear-gradient(180deg,var(--bg) 0%,#071024 100%);
  color:#e6eef6;display:flex;align-items:center;justify-content:center;padding:20px}
  .card{width:min(720px,100%);background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
  border-radius:18px;padding:20px;box-shadow:0 8px 30px rgba(2,6,23,0.6);display:grid;grid-template-columns:1fr 220px;gap:16px;align-items:center}
  h1{margin:0 0 8px;font-size:20px}p{margin:0 0 14px;color:var(--muted)}
  .jar{background:linear-gradient(180deg,#071428 0%,#033050 100%);border-radius:12px;padding:12px;min-height:120px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden;
  border:1px solid rgba(255,255,255,0.03)}
  .total{font-weight:700;font-size:36px;display:flex;align-items:center;gap:8px}
  .coin-icon{width:28px;height:28px;transform:translateY(2px)}.muted{color:var(--muted);font-size:13px;margin-top:6px}
  .controls{display:flex;flex-direction:column;gap:12px;align-items:stretch}
  button{border:0;padding:14px;border-radius:12px;font-weight:700;font-size:16px;cursor:pointer;
  box-shadow:0 6px 18px rgba(2,6,23,0.35)}
  .btn-add{background:linear-gradient(90deg,#ffb84d,#ffd166);color:#0a0a0a}
  .btn-reset{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03)}
  .coin{position:absolute;width:36px;height:36px;animation:floatUp 1.2s forwards cubic-bezier(.2,.9,.2,1);pointer-events:none}
  @keyframes floatUp{0%{transform:translateY(0) scale(1) rotate(0deg);opacity:1}30%{transform:translateY(-40px) scale(1.08) rotate(10deg);opacity:1}100%{transform:translateY(-160px) scale(.8) rotate(60deg);opacity:0}}
  @media(max-width:720px){.card{grid-template-columns:1fr;padding:16px}.controls{flex-direction:row}.controls>*{flex:1}}
</style>
</head>
<body>
  <div class="card">
    <div>
      <h1>Gravatinha</h1>
      <div class="jar" id="jar">
        <div class="total">
          <svg class="coin-icon" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" fill="#ffd166"/><path d="M12 8v8M9 11h6" stroke="#0b1220" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span id="amount">0</span><span class="muted">춱</span>
        </div>
        <div class="muted" id="subtitle">Total de gorjetas</div>
      </div>
    </div>
    <div class="controls">
      <button class="btn-add" id="add5">+5</button>
      <button class="btn-reset" id="reset">Redefinir</button>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    // Importa m칩dulos Firebase diretamente do CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue, set, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // 游댠 Substitua pelos dados do seu Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDe_CON0OGCFSQTRdSdIl_80Lz9f3hIUTM",
    authDomain: "pote-gorjetas.firebaseapp.com",
    databaseURL: "https://pote-gorjetas-default-rtdb.firebaseio.com",
    projectId: "pote-gorjetas",
    storageBucket: "pote-gorjetas.firebasestorage.app",
    messagingSenderId: "184073135173",
    appId: "1:184073135173:web:b91c4f0cf268a4ee2b2f2c"
  };


    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const amountEl = document.getElementById("amount");
    const addBtn = document.getElementById("add5");
    const resetBtn = document.getElementById("reset");
    const jar = document.getElementById("jar");
    let total = 0;

    // Escuta altera칞칫es em tempo real
    const totalRef = ref(db, "total/valor");
    onValue(totalRef, (snapshot) => {
      total = snapshot.val() || 0;
      amountEl.textContent = total;
    });
    
    // Fun칞칚o para obter senha v치lida
    async function getValidPassword() {
      let senha = localStorage.getItem('tipjar_senha');
      let valid = false;
    
      while(!valid) {
        try {
          // tenta escrever temporariamente com 0 para testar
          await set(ref(db, "total/teste_senha"), { valor: 0, senha });
          valid = true; // se chegou aqui, senha est치 correta
          // remove n칩 de teste
          await set(ref(db, "total/teste_senha"), null);
        } catch(e) {
          // se der erro, pede nova senha
          senha = prompt("Senha incorreta! Digite novamente:");
          localStorage.setItem('tipjar_senha', senha);
        }
      }
      return senha;
    }
    
    // Ao carregar o site
    (async ()=>{
      const senhaValida = await getValidPassword();
      console.log("Senha v치lida:", senhaValida);
    })();

    // Fun칞칚o para adicionar gorjeta
    addBtn.addEventListener("click", async () => {
      total += 5;
      spawnCoins(5);
      await set(ref(db, "total"), { valor: total, senha }); // envia senha automaticamente
    });

    // Fun칞칚o para resetar
    resetBtn.addEventListener("click", async () => {
      if(!confirm("Redefinir total?")) return;
      await set(ref(db, "total"), { valor: 0, senha });
    });

    // anima칞칚o das moedinhas
    function spawnCoins(n) {
      const coins = Math.min(8, Math.ceil(n / 5));
      for (let i = 0; i < coins; i++) {
        const c = document.createElement("div");
        c.className = "coin";
        c.innerHTML = `<svg viewBox="0 0 24 24" width="36" height="36"><circle cx="12" cy="12" r="10" fill="#ffd166"/><path d="M12 8v8M9 11h6" stroke="#0b1220" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
        const jarRect = jar.getBoundingClientRect();
        c.style.left = Math.random() * (jarRect.width - 40) + "px";
        c.style.bottom = "10px";
        jar.appendChild(c);
        c.addEventListener("animationend", () => c.remove());
      }
    }
  </script>
</body>
</html>
